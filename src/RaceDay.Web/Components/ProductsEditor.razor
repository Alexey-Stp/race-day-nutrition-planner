@using RaceDay.Core

<div class="form-card">
    <h2>ü•§ Available Products</h2>
    
    <div class="products-section">
        <h3>Gels</h3>
        @if (Gels.Count == 0)
        {
            <p class="empty-message">No gels added yet</p>
        }
        else
        {
            <div class="table-responsive">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th class="text-right">Carbs (g)</th>
                            <th class="text-right">Sodium (mg)</th>
                            <th class="text-center" style="width: 50px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var (index, product) in Gels.Select((p, i) => (i, p)))
                        {
                            <tr>
                                <td>
                                    <input type="text" @bind="product.Name" placeholder="Product name" 
                                           class="form-control form-control-sm" />
                                </td>
                                <td class="text-right">
                                    <input type="number" @bind="product.CarbsG" class="form-control form-control-sm" 
                                           min="0" step="0.1" style="text-align: right;" />
                                </td>
                                <td class="text-right">
                                    <input type="number" @bind="product.SodiumMg" class="form-control form-control-sm" 
                                           min="0" step="1" style="text-align: right;" />
                                </td>
                                <td class="text-center">
                                    <button @onclick="@(() => RemoveGel(index))" class="btn btn-sm btn-icon" 
                                            title="Remove product" disabled="@(Gels.Count <= 1)">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        <button @onclick="AddGel" class="btn btn-sm btn-secondary">+ Add Gel</button>
    </div>

    <div class="products-section">
        <h3>Drinks</h3>
        @if (Drinks.Count == 0)
        {
            <p class="empty-message">No drinks added yet</p>
        }
        else
        {
            <div class="table-responsive">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th class="text-right">Carbs (g)</th>
                            <th class="text-right">Sodium (mg)</th>
                            <th class="text-right">Volume (ml)</th>
                            <th class="text-center" style="width: 50px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var (index, product) in Drinks.Select((p, i) => (i, p)))
                        {
                            <tr>
                                <td>
                                    <input type="text" @bind="product.Name" placeholder="Product name" 
                                           class="form-control form-control-sm" />
                                </td>
                                <td class="text-right">
                                    <input type="number" @bind="product.CarbsG" class="form-control form-control-sm" 
                                           min="0" step="0.1" style="text-align: right;" />
                                </td>
                                <td class="text-right">
                                    <input type="number" @bind="product.SodiumMg" class="form-control form-control-sm" 
                                           min="0" step="1" style="text-align: right;" />
                                </td>
                                <td class="text-right">
                                    <input type="number" @bind="product.VolumeMl" class="form-control form-control-sm" 
                                           min="50" step="50" style="text-align: right;" />
                                </td>
                                <td class="text-center">
                                    <button @onclick="@(() => RemoveDrink(index))" class="btn btn-sm btn-icon" 
                                            title="Remove product" disabled="@(Drinks.Count <= 1)">
                                        üóëÔ∏è
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        <button @onclick="AddDrink" class="btn btn-sm btn-secondary">+ Add Drink</button>
    </div>
</div>

@code {
    public class ProductEditor
    {
        public string Name { get; set; } = "";
        public double CarbsG { get; set; }
        public double SodiumMg { get; set; }
        public double VolumeMl { get; set; }
    }

    [Parameter]
    public List<ProductEditor> Gels { get; set; } = new();

    [Parameter]
    public List<ProductEditor> Drinks { get; set; } = new();

    [Parameter]
    public EventCallback<List<ProductEditor>> GelsChanged { get; set; }

    [Parameter]
    public EventCallback<List<ProductEditor>> DrinksChanged { get; set; }

    private async Task AddGel()
    {
        Gels.Add(new ProductEditor());
        await GelsChanged.InvokeAsync(Gels);
    }

    private async Task RemoveGel(int index)
    {
        if (Gels.Count > 1)
        {
            Gels.RemoveAt(index);
            await GelsChanged.InvokeAsync(Gels);
        }
    }

    private async Task AddDrink()
    {
        Drinks.Add(new ProductEditor { VolumeMl = 500 });
        await DrinksChanged.InvokeAsync(Drinks);
    }

    private async Task RemoveDrink(int index)
    {
        if (Drinks.Count > 1)
        {
            Drinks.RemoveAt(index);
            await DrinksChanged.InvokeAsync(Drinks);
        }
    }
}
